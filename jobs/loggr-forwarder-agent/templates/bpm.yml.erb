<%
    downstream_ingress_addrs = p("downstream_ingress_ports").map do |port|
        "127.0.0.1:#{port}"
    end.join(",")
%>
processes:
  - name: loggr-forwarder-agent
    executable: /var/vcap/packages/forwarder-agent/forwarder-agent
    env:
      API_CA_FILE_PATH: "/var/vcap/jobs/forwarder-agent/config/certs/api_ca.crt"
      API_CERT_FILE_PATH: "/var/vcap/jobs/forwarder-agent/config/certs/api_client.crt"
      API_KEY_FILE_PATH: "/var/vcap/jobs/forwarder-agent/config/certs/api_client.key"
      API_COMMON_NAME: <%= p("api.tls.cn") %>
      API_URL: <%= "https://#{link("cloud_controller").address}:9023" %>
      API_POLLING_INTERVAL: "<%= p("api.polling_interval") %>"
      API_BATCH_SIZE: "<%= p("api.batch_size") %>"

      AGENT_CA_FILE_PATH: "/var/vcap/jobs/forwarder-agent/config/certs/loggregator_ca.crt"
      AGENT_CERT_FILE_PATH: "/var/vcap/jobs/forwarder-agent/config/certs/forwarder.crt"
      AGENT_KEY_FILE_PATH: "/var/vcap/jobs/forwarder-agent/config/certs/forwarder.key"
      AGENT_CIPHER_SUITES: "<%= p("tls.cipher_suites").split(":").join(",") %>"
      AGENT_PORT: <%= p("port") %>

      DOWNSTREAM_INGRESS_ADDRS: "<%= downstream_ingress_addrs %>"
      DRAIN_SKIP_CERT_VERIFY: "<%= p("drain_skip_cert_verify") %>"
